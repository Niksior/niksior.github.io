<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>eksporty</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-size: 0;
        }
    </style>
    <script src="js/Detector.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/Animation.js"></script>
    <script src="js/AnimationHandler.js"></script>
    <script src="js/KeyFrameAnimation.js"></script>
    <script src="js/ColladaLoader.js"></script>
    <script src="js/stats.min.js"></script>

</head>



<body id="zupa">
    <script>
   

      /*  var cloader = new THREE.ColladaLoader();
        cloader.load('sofa.DAE', function ( collada ) {
            sofa=collada.scene;
            sofa.position.set(-90,-90,50);
            sofa.scale.set(1,1,1);
            sofa.updateMatrix();
            scene.add(sofa);
            }, function ( xhr ) {console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );}
        );
        */
        if (!Detector.webgl) Detector.addGetWebGLMessage();

        var container;
        var camera, scene, renderer, objects;
        var dae, skin, animation, kfAnimation;
        var clock = new THREE.Clock();
        var loader = new THREE.ColladaLoader();

        loader.load('wiatrak.dae', function (collada) {

            dae = collada.scene;
            skin = collada.skins[0];
            animation = collada.animations[0];

            dae.scale.x = dae.scale.y = dae.scale.z = 1;


            dae.traverse(function (child) {
                if (child instanceof THREE.SkinnedMesh) {
                    var animation = new THREE.Animation(child, child.geometry.animation);
                    animation.play();
                }
            });

            dae.position.set(0, 0, 0);
            dae.updateMatrix();

            init();
            animate();
        });

        function init() {

            container = document.createElement('div');
            document.body.appendChild(container);

            scene = new THREE.Scene();

            // Add the camera
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.set(50, 50, 130);
            camera.lookAt(scene.position);

            // Add the Collada
            scene.add(dae);

            /*var animHandler = THREE.AnimationHandler;
            animHandler.add(animation);

            kfAnimation = new THREE.KeyFrameAnimation(animation.node, animation.name);
            kfAnimation.timeScale = 1;
            kfAnimation.play(true, 0);*/

            // Add the light
            // var directionalLight = new THREE.DirectionalLight(0x000000);
            // directionalLight.position.set(0.5, 50, 0.5);
            // scene.add(directionalLight);
            var light = new THREE.PointLight(0xFFFFFF);
            light.position.set(0, 150, 150);
            scene.add(light);

            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0xDDDDDD, 1);
            container.appendChild(renderer.domElement);
        }

        

        function animate() {
            var t;
                var delta = clock.getDelta();
                if (t > 1) t = 0;
                if (skin) {
                    for (var i = 0; i < skin.morphTargetInfluences.length; i++) {
                        skin.morphTargetInfluences[i] = 0;
                    }
                    skin.morphTargetInfluences[Math.floor(t * 30)] = 1;
                    t += delta;
                }
                requestAnimationFrame(animate);
                render();
            }
        

        function render() {

            renderer.render(scene, camera);
        }
        

			
		
        </script>

    </body>
</html>