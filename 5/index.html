<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>auto</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-size: 0;
	    z-index: 0;
        }
	#clk {
		padding: 20px;
		font-size: 15px;
		border: 4px;
		z-index: 20;
		position: fixed;
		top: 20px;
		left: 20px;
		width: 100px;
		background: white;
		color: black;
	}
    </style>
    <script src="js/three.min.js"></script>
    <script src="js/Animation.js"></script>
    <script src="js/AnimationHandler.js"></script>
    <script src="js/KeyFrameAnimation.js"></script>
    <script src="js/ColladaLoader.js"></script>

</head>



<body id="zupa">
	<div id="clk">...</div>
    <script>

    var WIDTH = window.innerWidth;
    var HEIGHT = window.innerHeight;

    document.addEventListener('keydown', onDocumentKeyDown, false);
    document.addEventListener('keyup', onDocumentKeyUp, false);

    var xu = 0, zu = 0, yu=0, w_down = false, s_down = false, a_down = false, d_down = false, key_up = false, key_down = false, key_left = false, key_right = false;
	var delta_fi = 0.03, delta_fi2 = 2, delta_fi3 = 0.01, delta_dR = 0.0001, fi = 0, fi2 = 0, fi3 = 0, dR = 0, k = Math.PI / 180, fi_rad = 0;
    
    function onDocumentKeyDown(event) {
        event = event || window.event;
        var keycode = event.keyCode;
        switch (keycode) {
            case 37:
                console.log("left down");
                key_left = true;
                break;
            case 38:
                console.log("up down");
                key_up = true;
                break;
            case 39:
                console.log("right down");
                key_right = true;
                break;
            case 40:
                console.log("down down");
                key_down = true;
                break;
            case 87:
                console.log("z down");
                w_down = true;
                break;
            case 83:
                console.log("x down");
                s_down = true;
                break;
            case 65:
                console.log("z down");
                a_down = true;
                break;
            case 68:
                console.log("x down");
                d_down = true;
                break;
        }
    }

    function onDocumentKeyUp(event) {
        event = event || window.event;
        var keycode = event.keyCode;
        switch (keycode) {
            case 37:
                console.log("left up");
                key_left = false;
                break;
            case 38:
                console.log("up up");
                key_up = false;
                break;
            case 39:
                console.log("right up");
                key_right = false;
                break;
            case 40:
                console.log("down up");
                key_down = false;
                break;
            case 87:
                console.log("z down");
                w_down = false;
                break;
            case 83:
                console.log("x down");
                s_down = false;
                break;
            case 65:
                console.log("z down");
                a_down = false;
                break;
            case 68:
                console.log("x down");
                d_down = false;
                break;
        }
    }

        

    var renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(WIDTH, HEIGHT);
    renderer.setClearColor(0x000000, 1);
    document.body.appendChild(renderer.domElement);

    var scene = new THREE.Scene();

    var camera = new THREE.PerspectiveCamera(50, WIDTH / HEIGHT, 0.1, 10000);
    camera.position.z = 300;
    camera.position.y = -600;
    camera.rotation.x = 1;
    scene.add(camera);

    var cloader = new THREE.ColladaLoader();
    cloader.load('mu/mustang.DAE', function (collada) {
        sofa = collada.scene;
        sofa.position.set(0, 0, 0);
        sofa.scale.set(20, 20, 20);
        sofa.rotation.x = 1.7;
        sofa.updateMatrix();
        scene.add(sofa);
        }, function ( xhr ) {console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );}
    );

    var light = new THREE.PointLight(0x996600);
    light.position.set(0, 100, 100);
    scene.add(light);

    var Texture = new THREE.TextureLoader().load("tor.png");
    Texture.generateMipmaps;
    var Material = new THREE.MeshBasicMaterial({ map: Texture, side: THREE.DoubleSide });
    var Geometry = new THREE.PlaneGeometry(5000, 5000, 1, 1);
    var plane = new THREE.Mesh(Geometry, Material);
    plane.position.set(0, 0, 0);
    scene.add(plane);

    function clock(){
		var k;
		var zw = dR*1000;
		var ww = zw.toFixed(2);
		k = "Your speed: " + ww + "clicks";
		document.getElementById("clk").innerHTML = k;
	}

	function restart(){
		xu = 0; zu = 0; yu=0; w_down = false; s_down = false; a_down = false; d_down = false;
		key_up = false; key_down = false; key_left = false; key_right = false;	
		delta_fi = 0.03; delta_fi2 = 2; delta_fi3 = 0.01; delta_dR = 0.0001; fi = 0; fi2 = 0; fi3 = 0; dR = 0; k = Math.PI / 180, fi_rad = 0;
		plane.material.map.offset.x=-0.44; plane.material.map.offset.y = 0;
		alert("404 - road not found");
		}


	plane.material.map.offset.x=-0.47; plane.material.map.offset.y = 0;


    function render() {
        requestAnimationFrame(render);
        renderer.render(scene, camera);


        if (key_down == true) dR -= delta_dR;        
	if (key_up == true) dR += delta_dR;


        if (key_left == true) {
            fi -= delta_fi;
            fi2 -= delta_fi2;
        }
        if (key_right == true) {
            fi += delta_fi;
            fi2 += delta_fi2;
        }
        if (w_down == true) {
            camera.position.y += 5;
        }
        if (s_down == true) {
            camera.position.y -= 5;
        }
        if (a_down == true) {
            camera.position.x -= 5;
        }
        if (d_down == true) {
            camera.position.x += 5;
        }

        plane.material.map.offset.y += dR * Math.cos(fi);
        plane.material.map.offset.x += dR * Math.sin(fi);
 	
	if(plane.material.map.offset.x > 0.6 || plane.material.map.offset.x < -0.8) restart();
	if(plane.material.map.offset.y > 0.6 || plane.material.map.offset.y < -0.1) restart();
        plane.rotation.z = fi;
	clock();
    }
	
	
	
    render();

    </script>

</body>
</html>
